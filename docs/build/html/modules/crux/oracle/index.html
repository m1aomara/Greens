
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Oracle &#8212; Greens Project  documentation</title>
    
  <link rel="stylesheet" href="../../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Tokenomics" href="../tokenomics/index.html" />
    <link rel="prev" title="IPFS" href="../ipfs/index.html" />

<!-- VUE -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6/dist/vue.min.js"></script>

<!-- Vuetify -->
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">

<!-- Mermaid Js -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>

<script src="https://cdn.jsdelivr.net/npm/vue-cute-timeline@1.2.8/dist/vue-cute-timeline.min.js"></script>



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../../../index.html">
    
      <p class="title">Greens Project</p>
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../theBasis/index.html">The Basis</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../introduction/index.html">The Problem Statement & Solution</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="../index.html">The Crux</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../end/index.html">The End</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../appexdix/index.html">Appendix</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../references/index.html">Links & References</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../team/index.html">Team Profile</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="../Escrow/index.html">Escrow</a>
                </li>
            
          
            
                <li class="">
                    <a href="../ipfs/index.html">IPFS</a>
                </li>
            
          
            
                <li class="active">
                    <a href="">Oracle</a>
                </li>
            
          
            
                <li class="">
                    <a href="../tokenomics/index.html">Tokenomics</a>
                </li>
            
          
            
                <li class="">
                    <a href="../erc20/index.html">Utility Green Token ERC20</a>
                </li>
            
          
            
                <li class="">
                    <a href="../ui/index.html">UI-Screenflow</a>
                </li>
            
          
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#springboot-mongo-rest" class="nav-link">SpringBoot Mongo Rest</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#oracle-smart-contract" class="nav-link">Oracle Smart Contract</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#backend-express-service" class="nav-link">Backend Express service</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#vue-js-dapp-service" class="nav-link">Vue.js DApp service</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="oracle">
<h1>Oracle<a class="headerlink" href="#oracle" title="Permalink to this headline">¶</a></h1>
<img alt="../../../_images/oracle-1.png" src="../../../_images/oracle-1.png" />
<div class="section" id="springboot-mongo-rest">
<h2>SpringBoot Mongo Rest<a class="headerlink" href="#springboot-mongo-rest" title="Permalink to this headline">¶</a></h2>
<p>MongoDB collection diagram</p>
<img alt="../../../_images/oracle-box-diagram-1.png" src="../../../_images/oracle-box-diagram-1.png" />
<p>Run MongoDB container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -d -p <span class="m">27017</span>:27017  --name mongodbProject   mongo  --bind_ip<span class="o">=</span><span class="m">0</span>.0.0.0
</pre></div>
</div>
<p>Connect to MongoDB shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it mongodbProject bash
</pre></div>
</div>
<p>Then run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mongo
use Tracker
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>db.energyTracker.insert<span class="o">(</span>
  <span class="o">{</span> <span class="s2">&quot;customerId&quot;</span>: <span class="s2">&quot;0001&quot;</span>,
  <span class="s2">&quot;serialNumber&quot;</span>: <span class="s2">&quot;325235234&quot;</span>,
  <span class="s2">&quot;mpxn&quot;</span>: <span class="s2">&quot;79898654&quot;</span>,
  <span class="s2">&quot;totalUnits&quot;</span>: <span class="s2">&quot;500&quot;</span>,
  <span class="s2">&quot;lastMeterRead&quot;</span>: <span class="s2">&quot;01-03-2021&quot;</span>
<span class="o">})</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>db.energyTracker.insert<span class="o">(</span>
  <span class="o">{</span> <span class="s2">&quot;customerId&quot;</span>: <span class="s2">&quot;0002&quot;</span>,
  <span class="s2">&quot;serialNumber&quot;</span>: <span class="s2">&quot;5235232523&quot;</span>,
  <span class="s2">&quot;mpxn&quot;</span>: <span class="s2">&quot;798468949&quot;</span>,
  <span class="s2">&quot;totalUnits&quot;</span>: <span class="s2">&quot;500&quot;</span>,
  <span class="s2">&quot;lastMeterRead&quot;</span>: <span class="s2">&quot;03-03-2021&quot;</span>
   <span class="o">})</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>db.energyTracker.insert<span class="o">(</span>
   <span class="o">{</span> <span class="s2">&quot;customerId&quot;</span>: <span class="s2">&quot;0003&quot;</span>,
   <span class="s2">&quot;serialNumber&quot;</span>: <span class="s2">&quot;534532452&quot;</span>,
   <span class="s2">&quot;mpxn&quot;</span>: <span class="s2">&quot;798416598&quot;</span>,
   <span class="s2">&quot;totalUnits&quot;</span>: <span class="s2">&quot;500&quot;</span>,
   <span class="s2">&quot;lastMeterRead&quot;</span>: <span class="s2">&quot;02-03-2021&quot;</span>
    <span class="o">})</span>
</pre></div>
</div>
<p>Go to <a class="reference external" href="https://start.spring.io">https://start.spring.io</a> and the following dependencies and create the project.</p>
<img alt="../../../_images/mongo1.png" src="../../../_images/mongo1.png" />
<ul class="simple">
<li><p>Download the ZIP file and extract it, open the extracted directory in IntelliJ IDEA.</p></li>
<li><p>Create the directory structure as shown below:</p></li>
</ul>
<img alt="../../../_images/mongo2.png" src="../../../_images/mongo2.png" />
<p>Add the following code in EnergyTracker.java:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.OracleMongo.model</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.annotation.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.mapping.Document</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="nd">@Document</span><span class="p">(</span><span class="n">collection</span> <span class="o">=</span> <span class="s">&quot;customers&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EnergyTracker</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">customerId</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">serialNumber</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">mpxn</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">totalUnits</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">lastMeterRead</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCustomerId</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">customerId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;EnergyTracker{&quot;</span> <span class="o">+</span>
                <span class="s">&quot;customerId=&#39;&quot;</span> <span class="o">+</span> <span class="n">customerId</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                <span class="s">&quot;, serialNumber=&quot;</span> <span class="o">+</span> <span class="n">serialNumber</span> <span class="o">+</span>
                <span class="s">&quot;, mpxn=&quot;</span> <span class="o">+</span> <span class="n">mpxn</span> <span class="o">+</span>
                <span class="s">&quot;, totalUnits=&quot;</span> <span class="o">+</span> <span class="n">totalUnits</span> <span class="o">+</span>
                <span class="s">&quot;, lastMeterRead=&quot;</span> <span class="o">+</span> <span class="n">lastMeterRead</span> <span class="o">+</span>
                <span class="sc">&#39;}&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCustomerId</span><span class="p">(</span><span class="n">String</span> <span class="n">customerId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">customerId</span> <span class="o">=</span> <span class="n">customerId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getSerialNumber</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">serialNumber</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSerialNumber</span><span class="p">(</span><span class="n">Integer</span> <span class="n">serialNumber</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">serialNumber</span> <span class="o">=</span> <span class="n">serialNumber</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getMpxn</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">mpxn</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMpxn</span><span class="p">(</span><span class="n">Integer</span> <span class="n">mpxn</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">mpxn</span> <span class="o">=</span> <span class="n">mpxn</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getTotalUnits</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">totalUnits</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTotalUnits</span><span class="p">(</span><span class="n">Integer</span> <span class="n">totalUnits</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">totalUnits</span> <span class="o">=</span> <span class="n">totalUnits</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getLastMeterRead</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">lastMeterRead</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLastMeterRead</span><span class="p">(</span><span class="n">String</span> <span class="n">lastMeterRead</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">lastMeterRead</span> <span class="o">=</span> <span class="n">lastMeterRead</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Add the following code in TrackerRepository.java:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@RepositoryRestResource</span><span class="p">(</span><span class="n">collectionResourceRel</span> <span class="o">=</span> <span class="s">&quot;Tracker&quot;</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s">&quot;Tracker&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TrackerRepository</span> <span class="kd">extends</span> <span class="n">MongoRepository</span><span class="o">&lt;</span><span class="n">EnergyTracker</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">EnergyTracker</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Add the following code in application.properties:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>server.port<span class="o">=</span><span class="m">8089</span>

spring.data.mongodb.host<span class="o">=</span><span class="m">0</span>.0.0.0
spring.data.mongodb.port<span class="o">=</span><span class="m">27017</span>
spring.data.mongodb.database<span class="o">=</span>Tracker
</pre></div>
</div>
<p>Then run the Spring app:</p>
<img alt="../../../_images/mongo3.png" src="../../../_images/mongo3.png" />
<p>The app will run as shown:</p>
<img alt="../../../_images/mongo4.png" src="../../../_images/mongo4.png" />
<p>Go to <a class="reference external" href="http://localhost:8089/Tracker">http://localhost:8089/Tracker</a> to GET the request:</p>
<img alt="../../../_images/mongo5.png" src="../../../_images/mongo5.png" />
</div>
<div class="section" id="oracle-smart-contract">
<h2>Oracle Smart Contract<a class="headerlink" href="#oracle-smart-contract" title="Permalink to this headline">¶</a></h2>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">&gt;=</span><span class="mf">0.4.22</span> <span class="o">&lt;</span><span class="mf">0.7.0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">EnergyMeterOracle</span> <span class="p">{</span>
    <span class="nx">address</span> <span class="nx">owner</span><span class="p">;</span>
    <span class="nx">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
            <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// quote structure</span>
    <span class="nx">struct</span> <span class="nx">energyMeterReadings</span> <span class="p">{</span>
            <span class="nx">uint</span> <span class="nx">serialNumber</span><span class="p">;</span>
            <span class="nx">uint</span> <span class="nx">totalUnits</span><span class="p">;</span>
            <span class="nx">uint256</span> <span class="nx">lastMeterRead</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">mapping</span><span class="p">(</span> <span class="nx">uint</span> <span class="p">=&gt;</span> <span class="nx">energyMeterReadings</span><span class="p">)</span> <span class="nx">meterReading</span><span class="p">;</span>

    <span class="c1">// address oracleOwner;</span>
    <span class="nx">modifier</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
            <span class="nx">require</span><span class="p">(</span>
                    <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">,</span>
                    <span class="s2">&quot;Only owner can call this function.&quot;</span>
            <span class="p">);</span>
            <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Set the meter Reading</span>
    <span class="kd">function</span> <span class="nx">setMeterReading</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">customerId</span><span class="p">,</span> <span class="nx">uint</span> <span class="nx">serialNumber</span><span class="p">,</span> <span class="nx">uint</span> <span class="nx">totalUnits</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">lastMeterRead</span><span class="p">)</span> <span class="nx">onlyOwner</span> <span class="kr">public</span> <span class="p">{</span>
            <span class="nx">energyMeterReadings</span> <span class="nx">memory</span> <span class="nx">_MeterReading</span> <span class="o">=</span> <span class="nx">energyMeterReadings</span><span class="p">({</span><span class="nx">serialNumber</span><span class="o">:</span> <span class="nx">serialNumber</span><span class="p">,</span> <span class="nx">totalUnits</span><span class="o">:</span><span class="nx">totalUnits</span><span class="p">,</span> <span class="nx">lastMeterRead</span><span class="o">:</span><span class="nx">lastMeterRead</span> <span class="p">});</span>
            <span class="nx">meterReading</span><span class="p">[</span><span class="nx">customerId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_MeterReading</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Get the serialNumber for customerId</span>
    <span class="kd">function</span> <span class="nx">getSerialNumber</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">customerId</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">meterReading</span><span class="p">[</span><span class="nx">customerId</span><span class="p">].</span><span class="nx">serialNumber</span><span class="p">;</span>
    <span class="p">}</span>

            <span class="c1">// Get the totalUnits value for customerId</span>
    <span class="kd">function</span> <span class="nx">getTotalUnits</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">customerId</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">meterReading</span><span class="p">[</span><span class="nx">customerId</span><span class="p">].</span><span class="nx">totalUnits</span><span class="p">;</span>
    <span class="p">}</span>

                    <span class="c1">// Get the lastMeterRead value for customerId</span>
    <span class="kd">function</span> <span class="nx">getLastMeterRead</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">customerId</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">meterReading</span><span class="p">[</span><span class="nx">customerId</span><span class="p">].</span><span class="nx">lastMeterRead</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="backend-express-service">
<h2>Backend Express service<a class="headerlink" href="#backend-express-service" title="Permalink to this headline">¶</a></h2>
<p>app.js</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">createError</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http-errors&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cookie-parser&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;morgan&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">indexRouter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">customersRouter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/customers&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">());</span>

<span class="c1">// view engine setup</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;views&#39;</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;view engine&#39;</span><span class="p">,</span> <span class="s1">&#39;jade&#39;</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">logger</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="nx">extended</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">indexRouter</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/customers&#39;</span><span class="p">,</span> <span class="nx">customersRouter</span><span class="p">);</span>

<span class="c1">// catch 404 and forward to error handler</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">next</span><span class="p">(</span><span class="nx">createError</span><span class="p">(</span><span class="mf">404</span><span class="p">));</span>
<span class="p">});</span>

<span class="c1">// error handler</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// set locals, only providing error in development</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;env&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;development&#39;</span> <span class="o">?</span> <span class="nx">err</span> <span class="o">:</span> <span class="p">{};</span>

  <span class="c1">// render the error page</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">||</span> <span class="mf">500</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">app</span><span class="p">;</span>
</pre></div>
</div>
<p>routes/index.js</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">fetch</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;node-fetch&#39;</span><span class="p">);</span>

<span class="cm">/* GET home page. */</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">provenanceData</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span>  <span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;http://192.168.0.144:8089/Tracker&quot;</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">rawProvenanceData</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
  <span class="nx">provenanceData</span><span class="p">.</span><span class="nx">serialNumber</span> <span class="o">=</span> <span class="nx">rawProvenanceData</span><span class="p">[</span><span class="s1">&#39;_embedded&#39;</span><span class="p">][</span><span class="s1">&#39;Tracker&#39;</span><span class="p">][</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;serialNumber&#39;</span><span class="p">]</span>
  <span class="nx">provenanceData</span><span class="p">.</span><span class="nx">totalUnits</span> <span class="o">=</span> <span class="nx">rawProvenanceData</span><span class="p">[</span><span class="s1">&#39;_embedded&#39;</span><span class="p">][</span><span class="s1">&#39;Tracker&#39;</span><span class="p">][</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;totalUnits&#39;</span><span class="p">];</span>
  <span class="nx">provenanceData</span><span class="p">.</span><span class="nx">lastMeterRead</span> <span class="o">=</span> <span class="nx">rawProvenanceData</span><span class="p">[</span><span class="s1">&#39;_embedded&#39;</span><span class="p">][</span><span class="s1">&#39;Tracker&#39;</span><span class="p">][</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;lastMeterRead&#39;</span><span class="p">];</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">provenanceData</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">provenanceData</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="vue-js-dapp-service">
<h2>Vue.js DApp service<a class="headerlink" href="#vue-js-dapp-service" title="Permalink to this headline">¶</a></h2>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>&lt;template&gt;
  &lt;v-app&gt;
    &lt;v-app-bar app color=&quot;primary&quot; dark&gt;
      &lt;v-spacer&gt;&lt;/v-spacer&gt;
    &lt;/v-app-bar&gt;
    &lt;v-main&gt;
      &lt;v-container&gt;
        &lt;v-btn @click=&quot;oracleUpdate&quot;&gt;Deploy Oracle&lt;/v-btn&gt;
      &lt;/v-container&gt;
    &lt;/v-main&gt;
  &lt;/v-app&gt;
&lt;/template&gt;

&lt;script&gt;
import Web3 from &quot;web3&quot;;

export default {
  name: &quot;App&quot;,
  data() {
    return {
      abi: [
        {
          inputs: [
            {
              internalType: &quot;uint256&quot;,
              name: &quot;customerId&quot;,
              type: &quot;uint256&quot;,
            },
            {
              internalType: &quot;uint256&quot;,
              name: &quot;serialNumber&quot;,
              type: &quot;uint256&quot;,
            },
            {
              internalType: &quot;uint256&quot;,
              name: &quot;mpxn&quot;,
              type: &quot;uint256&quot;,
            },
            {
              internalType: &quot;uint256&quot;,
              name: &quot;totalUnits&quot;,
              type: &quot;uint256&quot;,
            },
            {
              internalType: &quot;uint256&quot;,
              name: &quot;lastMeterRead&quot;,
              type: &quot;uint256&quot;,
            },
          ],
          name: &quot;setMeterReading&quot;,
          outputs: [],
          stateMutability: &quot;nonpayable&quot;,
          type: &quot;function&quot;,
        },
        {
          inputs: [],
          stateMutability: &quot;nonpayable&quot;,
          type: &quot;constructor&quot;,
        },
        {
          inputs: [
            {
              internalType: &quot;uint256&quot;,
              name: &quot;customerId&quot;,
              type: &quot;uint256&quot;,
            },
          ],
          name: &quot;getLastMeterRead&quot;,
          outputs: [
            {
              internalType: &quot;uint256&quot;,
              name: &quot;&quot;,
              type: &quot;uint256&quot;,
            },
          ],
          stateMutability: &quot;view&quot;,
          type: &quot;function&quot;,
        },
        {
          inputs: [
            {
              internalType: &quot;uint256&quot;,
              name: &quot;customerId&quot;,
              type: &quot;uint256&quot;,
            },
          ],
          name: &quot;getMpxn&quot;,
          outputs: [
            {
              internalType: &quot;uint256&quot;,
              name: &quot;&quot;,
              type: &quot;uint256&quot;,
            },
          ],
          stateMutability: &quot;view&quot;,
          type: &quot;function&quot;,
        },
        {
          inputs: [
            {
              internalType: &quot;uint256&quot;,
              name: &quot;customerId&quot;,
              type: &quot;uint256&quot;,
            },
          ],
          name: &quot;getSerialNumber&quot;,
          outputs: [
            {
              internalType: &quot;uint256&quot;,
              name: &quot;&quot;,
              type: &quot;uint256&quot;,
            },
          ],
          stateMutability: &quot;view&quot;,
          type: &quot;function&quot;,
        },
        {
          inputs: [
            {
              internalType: &quot;uint256&quot;,
              name: &quot;customerId&quot;,
              type: &quot;uint256&quot;,
            },
          ],
          name: &quot;getTotalUnits&quot;,
          outputs: [
            {
              internalType: &quot;uint256&quot;,
              name: &quot;&quot;,
              type: &quot;uint256&quot;,
            },
          ],
          stateMutability: &quot;view&quot;,
          type: &quot;function&quot;,
        },
      ],
      ganacheUrl: &quot;http://127.0.0.1:7545&quot;,
    };
  },
  methods: {
    async oracleUpdate() {
      let provider = new Web3(new Web3.providers.HttpProvider(this.ganacheUrl));
      provider.eth.getAccounts((error, result) =&gt; {
        console.log(&quot;Address&quot;, result);
      });
      //From metamask
      let AddressOwner = &quot;0x2afAD5799Fd9F9FB2d2b80d5319cBF951232394f&quot;;
      //From Remix
      let contractAddress = &quot;0xBCA5A40EaE68a2E4f6b2F67854daDf8A34F0d393&quot;;
      let contractInstance = new provider.eth.Contract(this.abi, contractAddress);
      console.log(&quot;Contract instance&quot;, contractInstance);

      // let result = await fetch(&quot;http://localhost:8089/&quot;);
      // let json = await result.json();
      // console.log(`Price: ${json.customerId}`);
      // console.log(`Volume: ${json.serialNumber}`);
      // console.log(`Volume: ${json.mpxn}`);
      // console.log(`Volume: ${json.totalUnits}`);
      // console.log(`Volume: ${json.lastMeterRead}`);

      let json = {
        customerId: &quot;1234&quot;,
        serialNumber: &quot;1234&quot;,
        mpxn: &quot;1234&quot;,
        totalUnits: &quot;1234&quot;,
        lastMeterRead: &quot;12-12-2021&quot;
      }

      //Call the contract to set a meter reading data
      contractInstance.methods
        .setMeterReading(parseInt(json.customerId), parseInt(json.serialNumber), parseInt(json.mpxn), parseInt(json.totalUnits), parseInt(json.lastMeterRead))
        .send({ from: AddressOwner })
        .on(&quot;receipt&quot;, () =&gt; {
          console.log(&quot;Values Updated&quot;);
        });

      //Call the contract to get the the meter readings
      contractInstance.methods
        .getSerialNumber(parseInt(json.customerId))
        .send({ from: AddressOwner })
        .then((val) =&gt; {
          console.log(&quot;Serial Number: &quot;, val);
        });

      //Call the contract to get the stock volume
      contractInstance.methods
        .getMpxn(parseInt(json.customerId))
        .send({ from: AddressOwner })
        .then((val) =&gt; {
          console.log(&quot;mpxn: &quot;, val);
        });

      //Call the contract to get the stock volume
      contractInstance.methods
        .getTotalUnits(parseInt(json.customerId))
        .send({ from: AddressOwner })
        .then((val) =&gt; {
          console.log(&quot;Total Units: &quot;, val);
        });

      //Call the contract to get the stock volume
      contractInstance.methods
        .getLastMeterRead(parseInt(json.customerId))
        .send({ from: AddressOwner })
        .then((val) =&gt; {
          console.log(&quot;Last Meter Update Time: &quot;, val);
        });

    },
  },
};
&lt;/script&gt;
</pre></div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="../ipfs/index.html" title="previous page">IPFS</a>
    <a class='right-next' id="next-link" href="../tokenomics/index.html" title="next page">Tokenomics</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../../_static/js/index.3da636dd464baa7582d2.js"></script>


     <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2021, Team Osive.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.0+.<br/>
    </p>
  </div>
</footer>


  </body>
</html>